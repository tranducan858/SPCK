<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập / Đăng ký</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <div class="toggle-buttons">
                <button id="login-toggle" class="toggle-btn active">Đăng nhập</button>
                <button id="register-toggle" class="toggle-btn">Đăng ký</button>
            </div>
            <div id="login-form" class="form-container">
                <h2>Đăng nhập</h2>
                <form>
                    <div class="input-group">
                        <input type="text" id="login-email" required>
                        <label for="login-email">Email hoặc Tên tài khoản</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="login-password" required>
                        <label for="login-password">Mật khẩu</label>
                    </div>
                    <button type="submit" class="login-btn">Đăng nhập</button>
                    
                    <div class="options">
                        <label><input type="checkbox"> Ghi nhớ tôi</label>
                        <a href="#">Bạn cần trợ giúp?</a>
                    </div>
                </form>
            </div>
            <div id="register-form" class="form-container" style="display: none;">
                <h2>Đăng ký</h2>
                <form>
                    <div class="input-group">
                        <input type="email" id="register-email" required>
                        <label for="register-email">Email</label>
                    </div>
                    <div class="input-group">
                        <input type="text" id="register-username" required>
                        <label for="register-username">Tên tài khoản</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="register-password" required>
                        <label for="register-password">Mật khẩu</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="register-confirm-password" required>
                        <label for="register-confirm-password">Nhập lại mật khẩu</label>
                    </div>
                    
                    <button type="submit" class="login-btn">Đăng ký</button>
                    
                    <div class="options">
                        <label><input type="checkbox"> Ghi nhớ tôi</label>
                        <a href="#">Bạn cần trợ giúp?</a>
                    </div>
                </form>
            </div>

            <div class="footer-box">
                <small>Trang này được bảo vệ bởi Google reCAPTCHA.</small>
                <button id="show-storage-btn" style="margin-top: 10px; padding: 5px 10px; display: none;">Hiển thị dữ liệu lưu</button>
            </div>
        </div>
    </div>

    <script>
        const loginToggle = document.getElementById('login-toggle');
        const registerToggle = document.getElementById('register-toggle');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');

        // Elements for login form
        const loginEmail = document.getElementById('login-email');
        const loginPassword = document.getElementById('login-password');
        const loginRemember = loginForm.querySelector('input[type="checkbox"]');
        const loginSubmit = loginForm.querySelector('.login-btn');

        // Elements for register form
        const registerEmail = document.getElementById('register-email');
        const registerUsername = document.getElementById('register-username');
        const registerPassword = document.getElementById('register-password');
        const registerRemember = registerForm.querySelector('input[type="checkbox"]');
        const registerSubmit = registerForm.querySelector('.login-btn');

        // Button to show saved data
        const showStorageBtn = document.getElementById('show-storage-btn');

        // Handle show storage button
        showStorageBtn.addEventListener('click', () => {
            const loginEmail = localStorage.getItem('loginEmail') || 'Không có';
            const loginPassword = localStorage.getItem('loginPassword') || 'Không có';
            const registerEmail = localStorage.getItem('registerEmail') || 'Không có';
            const registerUsername = localStorage.getItem('registerUsername') || 'Không có';
            alert(`Dữ liệu lưu trong localStorage:\n\nĐăng nhập:\nEmail: ${loginEmail}\nMật khẩu: ${loginPassword}\n\nĐăng ký:\nEmail: ${registerEmail}\nTên tài khoản: ${registerUsername}`);
        });

        // Load saved data on page load
        window.addEventListener('load', () => {
            // If user is logged in and returning to login page, clear the fields
            if (localStorage.getItem('isLoggedIn') === 'true') {
                loginEmail.value = '';
                loginPassword.value = '';
                loginRemember.checked = false;
            } else {
                const savedLoginEmail = localStorage.getItem('loginEmail');
                const savedLoginPassword = localStorage.getItem('loginPassword');
                if (savedLoginEmail) loginEmail.value = savedLoginEmail;
                if (savedLoginPassword) loginPassword.value = savedLoginPassword;
                if (savedLoginEmail || savedLoginPassword) loginRemember.checked = true;
            }

            const savedRegisterEmail = localStorage.getItem('registerEmail');
            const savedRegisterUsername = localStorage.getItem('registerUsername');
            if (savedRegisterEmail) registerEmail.value = savedRegisterEmail;
            if (savedRegisterUsername) registerUsername.value = savedRegisterUsername;
            if (savedRegisterEmail || savedRegisterUsername) registerRemember.checked = true;
        });

        // Handle login form submit
        loginSubmit.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent actual submit for demo
            // Get registered users from localStorage
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
            // Check if user exists and password matches
            const user = registeredUsers.find(u => (u.email === loginEmail.value || u.username === loginEmail.value) && u.password === loginPassword.value);
            if (user) {
                if (loginRemember.checked) {
                    localStorage.setItem('loginEmail', loginEmail.value);
                    localStorage.setItem('loginPassword', loginPassword.value);
                } else {
                    localStorage.removeItem('loginEmail');
                    localStorage.removeItem('loginPassword');
                }
                localStorage.setItem('isLoggedIn', 'true');
                // Clear the login fields after successful login
                loginEmail.value = '';
                loginPassword.value = '';
                window.location.href = 'index.html';
            } else {
                alert('Tài khoản hoặc mật khẩu sai!'); // Error alert
            }
        });

        // Handle register form submit
        registerSubmit.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent actual submit for demo
            // Get registered users from localStorage
            let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
            // Check if email already exists
            const existingUser = registeredUsers.find(user => user.email === registerEmail.value);
            if (existingUser) {
                alert('Email đã được đăng ký!'); // Error alert
                return;
            }
            // Check if passwords match
            if (registerPassword.value !== document.getElementById('register-confirm-password').value) {
                alert('Mật khẩu xác nhận không khớp!'); // Error alert
                return;
            }
            // Add new user
            const newUser = {
                email: registerEmail.value,
                username: registerUsername.value,
                password: registerPassword.value
            };
            registeredUsers.push(newUser);
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            if (registerRemember.checked) {
                localStorage.setItem('registerEmail', registerEmail.value);
                localStorage.setItem('registerUsername', registerUsername.value);
            } else {
                localStorage.removeItem('registerEmail');
                localStorage.removeItem('registerUsername');
            }
            alert('Đăng ký thành công!'); // Demo alert
            // Automatically switch to login form after successful registration
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
            loginToggle.classList.add('active');
            registerToggle.classList.remove('active');
        });

        loginToggle.addEventListener('click', () => {
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
            loginToggle.classList.add('active');
            registerToggle.classList.remove('active');
        });

        registerToggle.addEventListener('click', () => {
            registerForm.style.display = 'block';
            loginForm.style.display = 'none';
            registerToggle.classList.add('active');
            loginToggle.classList.remove('active');
        });
    </script>
</body>
</html>
